# Example values for deploying worker with AWS ElastiCache
# Usage: helm install worker ./worker -f ./worker/values.elasticache.yaml

# Disable internal Redis since we're using ElastiCache
redis:
  enabled: false

# External Redis/ElastiCache configuration
externalRedis:
  # Replace with your actual ElastiCache endpoint
  # Example: my-cluster.abc123.cache.amazonaws.com
  host: "your-elasticache-cluster.cache.amazonaws.com"
  port: 6379
  # ElastiCache uses Redis 6.0+ ACL authentication (username + password)
  # IAM authentication is NOT supported for ElastiCache Redis
  username: "default"  # Redis 6.0+ ACL username (default is "default")
  password: ""         # Redis password (use a secret reference in production)
  # TLS configuration for ElastiCache (encryption-in-transit required by AWS)
  tls:
    enabled: true
    # Set to false in production with proper certificates
    skipVerify: false

# Worker specific configuration
worker:
  # Increase replicas for production workload
  replicaCount: 3

  # Database configuration (AWS RDS)
  database:
    # Replace with your RDS endpoint
    host: "your-rds-instance.region.rds.amazonaws.com"
    port: 5432
    name: "devmesh"
    user: "devmesh"
    password: "changeme"  # Use AWS Secrets Manager in production
    sslMode: "require"
    searchPath: "mcp,public"

  # AWS configuration for Bedrock
  aws:
    region: "us-east-1"
    # Leave empty to use IAM role
    accessKeyId: ""
    secretAccessKey: ""

  # Production resource requirements
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 1Gi

  # Pod affinity to spread across AZs
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
              - worker
          topologyKey: topology.kubernetes.io/zone

# Service Account with AWS IAM role (if using IRSA)
serviceAccount:
  create: true
  name: worker
  annotations:
    # Uncomment and configure for AWS IAM roles
    # eks.amazonaws.com/role-arn: arn:aws:iam::123456789012:role/WorkerRole

# Use same namespace as edge-mcp
namespace:
  create: false
  name: edge-mcp